<!DOCTYPE html>
<html>

<head>
    <title>Get App</title>
    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- 
            this is how to create the icon pack and manifest
            https://medium.com/@sam20gh/how-to-add-add-to-home-screen-to-your-website-4b07aee02676 

            and this is why it can't be automated on all browsers (IOS for example)
            https://love2dev.com/pwa/add-to-homescreen-library/
        -->
    <!--
            this is how to check if app is standalone:
            https://stackoverflow.com/questions/41742390/javascript-to-check-if-pwa-or-mobile-web
         -->
    <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="App">
</head>

<body id="body-element" class="bg">
    <img id="installation_guide" src="" />

    <div id="deviceDoesNotFit" style="visibility: hidden;" class="centered">
        <h2 style="direction: rtl;">יש להיכנס לקישור זה מסמארטפון<br>(אייפון או אנדרואיד).</h2>
    </div>
    <div id="app_will_load_soon" class="centered appIsLoading" style="visibility: visible;">
        <h1>...טוען</h1>
    </div>
    <div id="loading_animation" style="visibility: visible;">
        <div class="lds-ellipsis">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <iframe id="iframe-element" src="/" onload="onMyFrameLoad(this)"
        style="visibility: hidden; position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;">
        Your browser doesn't support iframes
    </iframe>
</body>
<script>
    var isInWebAppiOS = window.navigator.standalone === true;
    var isInWebAppChrome =
        window.matchMedia("(display-mode: fullscreen)").matches ||
        window.matchMedia("(display-mode: standalone)").matches ||
        window.matchMedia("(display-mode: minimal-ui)").matches;

    if (isInWebAppiOS || isInWebAppChrome) {
        var userId = /[&?]userId=([^&]+)/.exec(location.search)[1];
        var studyId = 9;
        var batchId = /[&?]batchId=([^&]+)/.exec(location.search)[1];

        var xxx = "/experiments/publix/" + studyId + "/start?" +
            "batchId=" + batchId +
            "&personalMultipleWorkerId=" + userId;

        document.getElementById('iframe-element').src = xxx;
    } else {
        document.getElementById('body-element').classList.remove('bg');
        document.getElementById('app_will_load_soon').style.visibility = 'hidden';
        document.getElementById('loading_animation').style.visibility = 'hidden';

        // Show installation instructions according to the device
        var mobileOS = getMobileOperatingSystem();
        if (mobileOS === 'iOS' || mobileOS === 'Android') {
            document.getElementById('installation_guide').setAttribute('src', 'images/instructions/installation_guide_' + mobileOS + '.jpg')
        } else {
            document.getElementById('deviceDoesNotFit').style.visibility = 'visible';
        }
    }

    function onMyFrameLoad() {
        if (isInWebAppiOS || isInWebAppChrome) {
            document.getElementById('iframe-element').style.visibility = 'visible';
            document.getElementById('app_will_load_soon').style.visibility = 'hidden';
            document.getElementById('loading_animation').style.visibility = 'hidden';
        }
    };

    function getMobileOperatingSystem() { // taken by Rani from https://stackoverflow.com/questions/21741841/detecting-ios-android-operating-system
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        // Windows Phone must come first because its UA also contains "Android"
        if (/windows phone/i.test(userAgent)) {
            return "Windows Phone";
        }
        if (/android/i.test(userAgent)) {
            return "Android";
        }
        // iOS detection from: http://stackoverflow.com/a/9039885/177710
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            return "iOS";
        }
        return "unknown";
    }
</script>

</html>