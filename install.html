<!DOCTYPE html>
<html>

<head>
    <title>Get App</title>
    <meta charset="UTF-8">
    <meta name='viewport' content='user-scalable=0'>
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- 
            this is how to create the icon pack and manifest
            https://medium.com/@sam20gh/how-to-add-add-to-home-screen-to-your-website-4b07aee02676 

            and this is why it can't be automated on all browsers (IOS for example)
            https://love2dev.com/pwa/add-to-homescreen-library/
        -->
    <!--
            this is how to check if app is standalone:
            https://stackoverflow.com/questions/41742390/javascript-to-check-if-pwa-or-mobile-web
         -->
    <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="App">

    <!-- Set splash screen for iphones: -->
    <!------------------------------------------------------------------>
    <!-- iPhone 5 and SE (640px x 1136px) V -->
    <link href="splashscreens/iphone5_and_se_splash.png"
        media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
        rel="apple-touch-startup-image" />
    <!-- iPhone 8, 7, 6s, 6 (750px x 1334px) V -->
    <link href="splashscreens/iphone6_and_6s_and_7_and_8_splash.png"
        media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
        rel="apple-touch-startup-image" />
    <!-- ** iPhone 6s Plus, 6 Plus , 7 Plus, 8 Plus (1242x x 2208px) V -->
    <link href="splashscreens/iphone_6plus_6Splus_7plus_8plus_splash.png"
        media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)"
        rel="apple-touch-startup-image" />
    <!-- iPhone X, XS, 11 pro (1125px x 2436px) V -->
    <link href="splashscreens/iphonex_and_xs_and_11_pro_splash.png"
        media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
        rel="apple-touch-startup-image" />
    <!-- iPhone XR and iphone 11 (828px x 1792px) V -->
    <link href="splashscreens/iphonexr_and_11_splash.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)"
        rel="apple-touch-startup-image" />
    <!-- iPhone XS max and iphone 11 pro max (1242px x 2688px) V -->
    <link href="splashscreens/iphonexsmax_and_11_pro_max_splash.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)"
        rel="apple-touch-startup-image" />

    <!-- iPhone 12 mini (1080px x 2340px V) -->
    <link href="splashscreens/iphone_12_mini_splash.png"
        media="(device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3)"
        rel="apple-touch-startup-image" />
    <!-- iPhone 12, 12 pro (1170px x 2532px) V -->
    <link href="splashscreens/iphone_12_and_12_pro_splash.png"
        media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"
        rel="apple-touch-startup-image" />
    <!-- iPhone 12 pro max (1284px x 2778px) V -->
    <link href="splashscreens/iphone_12_pro_max_splash.png"
        media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"
        rel="apple-touch-startup-image" />
    <!------------------------------------------------------------------>
</head>

<body id="body-element" class="bgInstallPage">

    <!-- App installation guide -->
    <img id="installation_guide" src="" />
    <div id="deviceDoesNotFit" style="width: 90%;" class="centered error_message hidden">
        <h2>יש להכנס לקישור זה מסמארטפון<br>(אייפון או אנדרואיד).</h2>
    </div>

    <!-- Loading Screen -->
    <div id="app_will_load_soon" class="centered appIsLoading">
        <h1>...טוען</h1>
    </div>
    <div id="loading_animation">
        <div class="lds-ellipsis">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <!-- iframe to run the app in -->
    <iframe id="iframe-element" src="/[PLACE_HOLDER]" onload="onMyFrameLoad(this)" class="hidden"
        style="position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;">
        Your browser doesn't support iframes
    </iframe>

</body>

<script>
    // check if implemented as PWA:
    var isInWebAppiOS = window.navigator.standalone === true;
    var isInWebAppChrome =
        window.matchMedia("(display-mode: fullscreen)").matches ||
        window.matchMedia("(display-mode: standalone)").matches ||
        window.matchMedia("(display-mode: minimal-ui)").matches;

    function onMyFrameLoad() {
        // if app PWA:
        if (isInWebAppiOS || isInWebAppChrome) {
            // first, prevent multiple reloads:
            document.getElementById('iframe-element').onload = ''

            // load index.html with the relevant info (for the iframe):
            var subId = /[&?]subId=([^&]+)/.exec(location.search)[1];                    
            var xxx = "index.html?" + "subId=" + subId;
            document.getElementById('iframe-element').src = xxx;

            // show the app (which run through the iframe element):
            document.getElementById('iframe-element').classList.remove('hidden');
            document.getElementById('app_will_load_soon').classList.add('hidden');
            document.getElementById('loading_animation').classList.add('hidden');

            // if app isn't PWA show specific installation instructions:
        } else {
            document.getElementById('app_will_load_soon').classList.add('hidden');
            document.getElementById('loading_animation').classList.add('hidden');

            // Show installation instructions according to the device type:
            var mobileOS = getMobileOperatingSystem();
            if (mobileOS === 'iOS' || mobileOS === 'Android') {
                document.getElementById('installation_guide').setAttribute('src', 'images/instructions/installation_guide_' + mobileOS + '.jpg')
            } else {
                document.getElementById('deviceDoesNotFit').classList.remove('hidden');
            }
        }
    };

    // get mobile func OS function:
    function getMobileOperatingSystem() { // taken by Rani from https://stackoverflow.com/questions/21741841/detecting-ios-android-operating-system
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        // Windows Phone must come first because its UA also contains "Android"
        if (/windows phone/i.test(userAgent)) {
            return "Windows Phone";
        }
        if (/android/i.test(userAgent)) {
            return "Android";
        }
        // iOS detection from: http://stackoverflow.com/a/9039885/177710
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            return "iOS";
        }
        return "unknown";
    }
</script>

</html>